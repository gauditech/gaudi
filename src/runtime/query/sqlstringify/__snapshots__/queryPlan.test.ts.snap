// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Query plan composes a query 1`] = `
{
  "filter": {
    "args": [
      {
        "args": [
          {
            "args": [
              {
                "fnName": "count",
                "kind": "aggregate-function",
                "sourcePath": [
                  "Org",
                  "repos",
                ],
                "targetPath": [
                  "issues",
                  "id",
                ],
                "type": {
                  "kind": "integer",
                  "nullable": false,
                },
              },
              {
                "fnName": "count",
                "kind": "aggregate-function",
                "sourcePath": [
                  "Org",
                  "repos",
                ],
                "targetPath": [
                  "issues",
                  "repo",
                  "id",
                ],
                "type": {
                  "kind": "integer",
                  "nullable": false,
                },
              },
            ],
            "kind": "function",
            "name": "+",
          },
          {
            "fnName": "sum",
            "kind": "aggregate-function",
            "sourcePath": [
              "Org",
              "repos",
            ],
            "targetPath": [
              "issues",
              "id",
            ],
            "type": {
              "kind": "integer",
              "nullable": false,
            },
          },
        ],
        "kind": "function",
        "name": "+",
      },
      {
        "args": [
          {
            "args": [
              {
                "fnName": "count",
                "kind": "aggregate-function",
                "sourcePath": [
                  "Org",
                  "repos",
                ],
                "targetPath": [
                  "issues",
                  "repo_name",
                ],
                "type": {
                  "kind": "integer",
                  "nullable": false,
                },
              },
              {
                "kind": "alias",
                "namePath": [
                  "Org",
                  "repos",
                  "ref_number",
                ],
              },
            ],
            "kind": "function",
            "name": "+",
          },
          {
            "fnName": "count",
            "kind": "aggregate-function",
            "sourcePath": [
              "Org",
            ],
            "targetPath": [
              "repos",
              "id",
            ],
            "type": {
              "kind": "integer",
              "nullable": false,
            },
          },
        ],
        "kind": "function",
        "name": "+",
      },
    ],
    "kind": "function",
    "name": ">",
  },
  "fromPath": [
    "Org",
    "repos",
  ],
  "kind": "query",
  "limit": undefined,
  "modelRefKey": "Org",
  "name": "$query",
  "offset": undefined,
  "orderBy": undefined,
  "refKey": "N/A",
  "retType": "Repo",
  "select": [
    {
      "alias": "id",
      "kind": "field",
      "name": "id",
      "namePath": [
        "Org",
        "repos",
        "id",
      ],
      "refKey": "Repo.id",
    },
    {
      "alias": "name",
      "kind": "field",
      "name": "name",
      "namePath": [
        "Org",
        "repos",
        "name",
      ],
      "refKey": "Repo.name",
    },
    {
      "alias": "org_name",
      "kind": "computed",
      "name": "org_name",
      "namePath": [
        "Org",
        "repos",
        "org_name",
      ],
      "refKey": "Repo.org_name",
    },
  ],
}
`;

exports[`Query plan stringifies the query plan 1`] = `
"SELECT
  "Org.repos"."id" AS "id",
  "Org.repos"."name" AS "name",
  "Org.repos.org"."name" AS "org_name"
FROM
  org AS "Org"
  JOIN repo AS "Org.repos" ON "Org"."id" = "Org.repos"."org_id"
  JOIN org AS "Org.repos.org" ON "Org.repos"."org_id" = "Org.repos.org"."id"
  JOIN (
    SELECT
      "Repo"."id" AS "__join_connection",
      count("Repo.issues"."id") AS "result"
    FROM
      repo AS "Repo"
      JOIN issue AS "Repo.issues" ON "Repo"."id" = "Repo.issues"."repo_id"
    GROUP BY
      "Repo"."id"
  ) AS "Org.repos.COUNT.issues.id" ON "Org.repos"."id" = "Org.repos.COUNT.issues.id"."__join_connection"
  JOIN (
    SELECT
      "Repo"."id" AS "__join_connection",
      count("Repo.issues.repo"."id") AS "result"
    FROM
      repo AS "Repo"
      JOIN issue AS "Repo.issues" ON "Repo"."id" = "Repo.issues"."repo_id"
      JOIN repo AS "Repo.issues.repo" ON "Repo.issues"."repo_id" = "Repo.issues.repo"."id"
    GROUP BY
      "Repo"."id"
  ) AS "Org.repos.COUNT.issues.repo.id" ON "Org.repos"."id" = "Org.repos.COUNT.issues.repo.id"."__join_connection"
  JOIN (
    SELECT
      "Repo"."id" AS "__join_connection",
      sum("Repo.issues"."id") AS "result"
    FROM
      repo AS "Repo"
      JOIN issue AS "Repo.issues" ON "Repo"."id" = "Repo.issues"."repo_id"
    GROUP BY
      "Repo"."id"
  ) AS "Org.repos.SUM.Repo.issues.id" ON "Org.repos"."id" = "Org.repos.SUM.Repo.issues.id"."__join_connection"
  JOIN (
    SELECT
      "Repo"."id" AS "__join_connection",
      count("Repo.issues.repo"."name") AS "result"
    FROM
      repo AS "Repo"
      JOIN issue AS "Repo.issues" ON "Repo"."id" = "Repo.issues"."repo_id"
      JOIN repo AS "Repo.issues.repo" ON "Repo.issues"."repo_id" = "Repo.issues.repo"."id"
    GROUP BY
      "Repo"."id"
  ) AS "Org.repos.COUNT.issues.repo.name" ON "Org.repos"."id" = "Org.repos.COUNT.issues.repo.name"."__join_connection"
  JOIN (
    SELECT
      "Org"."id" AS "__join_connection",
      count("Org.repos"."id") AS "result"
    FROM
      org AS "Org"
      JOIN repo AS "Org.repos" ON "Org"."id" = "Org.repos"."org_id"
    GROUP BY
      "Org"."id"
  ) AS "Org.COUNT.repos.id" ON "Org"."id" = "Org.COUNT.repos.id"."__join_connection"
WHERE
  (
    "Org.repos.COUNT.issues.id"."result" + (
      "Org.repos.COUNT.issues.repo.id"."result" + "Org.repos.SUM.issues.id"."result"
    )
  ) > (
    "Org.repos.COUNT.issues.repo_name"."result" + (
      "Org.repos"."ref_number" + "Org.COUNT.repos.id"."result"
    )
  )"
`;
